### --- Includes ---
include ~/.config/sway/definitions.conf
include ~/.config/sway/windowrules.conf
include ~/.config/sway/keybinds.conf

input "type:keyboard" {
    xkb_layout us
}

### --- Aesthetics ---
default_border pixel 2
default_floating_border pixel 2
smart_gaps on
gaps inner 5
gaps outer 0

# IMPORTANT: Disable the built-in swaybar so Waybar can take over
bar {
    swaybar_command /usr/bin/true
}

### --- Startup ---
exec_always {
    # Waybar: Kill old instance first to prevent doubling
    pidof waybar && killall waybar; waybar -c ~/.config/waybar/waybar_sway -s ~/.config/waybar/style.css

    # SWWW Wallpaper: Ensure only one daemon runs
    pidof swww-daemon || swww-daemon

    # Notifications: Kill and restart to refresh config
    killall dunst; dunst

    /usr/bin/gnome-keyring-daemon --start --components=secrets
    
    # Clipboard manager: Ensure only one instance
    killall cb; cb

    # Udiskie: Ensure only one instance
    killall udiskie; udiskie

    # Network Applet: Kill and restart to prevent multiple icons
    killall nm-applet; nm-applet

    # Kanshi: Handles monitor profiles
    killall kanshi; kanshi

    # Always start the keyring
    /usr/bin/gnome-keyring-daemon --start --components=secrets
}

# Polkit & Auth
exec /usr/lib/polkit-kde-authentication-agent-1
